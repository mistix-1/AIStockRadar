@model AIStockRadar.Controllers.PreferencesViewModel

@{
    ViewData["Title"] = "Preferences";
}

<h2 class="mb-3">Set Your Preferences</h2>
<p class="text-muted">These settings help AIStockRadar tailor recommendations for you.</p>

<form asp-action="Prefrences" asp-controller="Account" method="post" class="mt-4" novalidate>
    @Html.AntiForgeryToken()

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <!-- Age -->
    <div class="mb-3">
        <label asp-for="Age" class="form-label"></label>
        <input asp-for="Age" type="number" min="0" step="1" class="form-control" placeholder="e.g., 25" />
        <span asp-validation-for="Age" class="text-danger"></span>
        <div class="form-text">Used for compliance rules and suitability checks.</div>
    </div>

    <!-- Capital -->
    <div class="mb-3">
        <label asp-for="Capital" class="form-label"></label>
        <input asp-for="Capital" type="number" min="0" step="0.01" class="form-control" placeholder="e.g., 50000" />
        <span asp-validation-for="Capital" class="text-danger"></span>
        <div class="form-text">Approximate amount you plan to invest through the app.</div>
    </div>

    <!-- Risk tolerance -->
    <div class="mb-3">
        <label class="form-label d-block">Risk tolerance</label>
        <div class="form-check">
            <input class="form-check-input" type="radio" asp-for="RiskTolerance" value="Bad" id="riskBad" />
            <label class="form-check-label" for="riskBad">I am bad with risk</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" asp-for="RiskTolerance" value="Ok" id="riskOk" />
            <label class="form-check-label" for="riskOk">I am ok with risk</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" asp-for="RiskTolerance" value="Good" id="riskGood" />
            <label class="form-check-label" for="riskGood">I am good with risk</label>
        </div>
        <span asp-validation-for="RiskTolerance" class="text-danger"></span>
        <div class="form-text">Influences position sizing and sell/hold thresholds.</div>
    </div>

    <!-- Priority ladder -->
    <div class="mb-3">
        <label class="form-label d-block">Ranking priorities (1 is highest)</label>

        <div class="row g-2">
            <div class="col-12 col-md-4">
                <label asp-for="Priority1" class="form-label"></label>
                <select asp-for="Priority1" class="form-select">
                    <option value="" disabled selected>Choose…</option>
                    <option value="Buzz">Buzz</option>
                    <option value="Financials">Financials</option>
                    <option value="GlobalTrend">Global trend</option>
                </select>
                <span asp-validation-for="Priority1" class="text-danger"></span>
            </div>
            <div class="col-12 col-md-4">
                <label asp-for="Priority2" class="form-label"></label>
                <select asp-for="Priority2" class="form-select">
                    <option value="" disabled selected>Choose…</option>
                    <option value="Buzz">Buzz</option>
                    <option value="Financials">Financials</option>
                    <option value="GlobalTrend">Global trend</option>
                </select>
                <span asp-validation-for="Priority2" class="text-danger"></span>
            </div>
            <div class="col-12 col-md-4">
                <label asp-for="Priority3" class="form-label"></label>
                <select asp-for="Priority3" class="form-select">
                    <option value="" disabled selected>Choose…</option>
                    <option value="Buzz">Buzz</option>
                    <option value="Financials">Financials</option>
                    <option value="GlobalTrend">Global trend</option>
                </select>
                <span asp-validation-for="Priority3" class="text-danger"></span>
            </div>
        </div>

        <div class="form-text mt-2">
            We’ll convert 1st/2nd/3rd into multipliers 3×/2×/1× for the three AIs.
        </div>

        <div class="mt-2 d-flex flex-wrap gap-2">
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="toggleExplain('buzz')">What is Buzz?</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="toggleExplain('financials')">What are Financials?</button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="toggleExplain('global')">What is Global Trend?</button>
        </div>
        <div id="explain-buzz" class="small text-muted mt-2" style="display:none;">
            Buzz AI scans news/social chatter to gauge market attention. High buzz can move prices, but beware hype.
        </div>
        <div id="explain-financials" class="small text-muted mt-2" style="display:none;">
            Financials AI grades companies on revenue, profitability, cash runway, debt, etc., adjusted for their stage.
        </div>
        <div id="explain-global" class="small text-muted mt-2" style="display:none;">
            Global Trend AI looks for structural themes (e.g., AI infrastructure, energy transitions) and leaders/enablers.
        </div>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Save preferences</button>
    </div>
</form>

<script>
    function toggleExplain(which) {
        const id = { buzz: 'explain-buzz', financials: 'explain-financials', global: 'explain-global' }[which];
        const el = document.getElementById(id);
        if (el) el.style.display = el.style.display === 'none' ? '' : 'none';
    }

    // Prevent duplicate selections across Priority1/2/3
    const selects = ['Priority1','Priority2','Priority3'].map(id => document.getElementById(id));
    function refreshOptions() {
        const chosen = new Set(selects.map(s => s.value).filter(v => v));
        selects.forEach(s => {
            Array.from(s.options).forEach(opt => {
                if (!opt.value) return;
                opt.disabled = (!s.value || s.value !== opt.value) && chosen.has(opt.value);
            });
        });
    }
    selects.forEach(s => s && s.addEventListener('change', refreshOptions));
</script>

<style>
    .form-label {
        font-weight: 600;
    }
</style>
