@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Add Stock";
}

<h1>Add Stock</h1>

@if (TempData["Error"] is string err)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert" data-auto-dismiss="10000">
        @err
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Success"] is string ok)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" data-auto-dismiss="10000">
        @ok
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form asp-action="AddStock" asp-controller="Stock" method="post">
    @Html.AntiForgeryToken()

    <div class="mb-3">
        <label class="form-label d-block">Side</label>

        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="side" id="sideBuy" value="Buy" checked />
            <label class="form-check-label" for="sideBuy">Buy</label>
        </div>

        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="side" id="sideSell" value="Sell" />
            <label class="form-check-label" for="sideSell">Sell</label>
        </div>
    </div>

    <div class="mb-3">
        <label for="ticker" class="form-label">Ticker</label>
        <input type="text" name="ticker" id="ticker" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="price" class="form-label">Price</label>
        <input type="number" step="0.01" name="price" id="price" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="amount" class="form-label">Amount</label>
        <input type="number" step="0.000001" name="amount" id="amount" class="form-control" required />
    </div>

    <div class="d-flex">
        <button type="submit" class="btn btn-primary" name="next" value="add">
            Save & Add Another
        </button>
        <button type="submit" class="btn btn-outline-secondary ms-2" name="next" value="dashboard">
            Save & View Dashboard
        </button>
    </div>
</form>

<script>
    // Auto-dismiss Bootstrap alerts after the delay in data-auto-dismiss (ms)
    // Works even if Bootstrap JS isn't loaded (falls back to simple hide)
    (function () {
      const alerts = document.querySelectorAll('.alert[data-auto-dismiss]');
      alerts.forEach(function (el) {
        const timeout = parseInt(el.getAttribute('data-auto-dismiss'), 10) || 10000;
        setTimeout(function () {
          try {
            if (window.bootstrap && bootstrap.Alert) {
              const instance = bootstrap.Alert.getOrCreateInstance(el);
              instance.close();
            } else {
              el.classList.remove('show');
              setTimeout(function(){ el.remove(); }, 150);
            }
          } catch (e) {
            el.style.display = 'none';
          }
        }, timeout);
      });
    })();
</script>
